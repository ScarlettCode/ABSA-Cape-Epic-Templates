<style>
  html,
  body {
    width: 1920px;
    height: 1080px;
    margin: 0;
    padding: 0;
  }
</style>

<body>

  <div>
    <div id="bm"></div>
  </div>

</body>

<script src="../../scripts/lottie.min.js" type="text/javascript"></script>
<script src="../../scripts/utils.js" type="text/javascript"></script>
<script src="../../scripts/webfontloader.js" type="text/javascript"></script>
<script src="../../scripts/moment.min.js" type="text/javascript"></script>
<script src="../../scripts/countdown.min.js" type="text/javascript"></script>

<script src="data.js" type="text/javascript"></script>

<script>
  WebFont.load({
    custom: {
      urls: ["../fonts/stylesheet.css"]
    }
  });
</script>

<script type="text/javascript">
  var container = document.getElementById("bm");

  var animation = bodymovin.loadAnimation({
    container: container,
    renderer: "svg",
    loop: false,
    autoplay: false,
    animationData: test
  });

  if (debug) {
    findElementLocations(animation);
    animation.play();
  }

  function play() {
    animation.stop();
    animation.play();
  }

  function stop() {
    animation.stop();
    animation.play();
  }

  function update(xml) {

    var parser = new DOMParser();
    var xlmDocument = parser.parseFromString(xml, "text/xml");

    var title = xlmDocument.evaluate(
      "/templateData/componentData[@id='title']/data/@value",
      xlmDocument,
      null,
      XPathResult.STRING_TYPE,
      null
    ).stringValue;


    animation.renderer.elements[27].elements[0].canResizeFont(true);
    animation.renderer.elements[27].elements[0].updateDocumentData({
        t: title
      },
      0
    );


    var element0Number = 0;
    var element1Number = 0;


    for (i = 1; i < 4; i++) {

      if (i == 1) {
        element0Number = 25;
      }
      if (i == 2) {
        element0Number = 23;
      }

      if (i == 3) {
        element0Number = 21;
      }

      var teamPosition = xlmDocument.evaluate(
        "/templateData/componentData[@id='team" + i + "position']/data/@value",
        xlmDocument,
        null,
        XPathResult.STRING_TYPE,
        null
      ).stringValue;

      var teamName = xlmDocument.evaluate(
        "/templateData/componentData[@id='team" + i + "name']/data/@value",
        xlmDocument,
        null,
        XPathResult.STRING_TYPE,
        null
      ).stringValue;

      var rider1Name = xlmDocument.evaluate(
        "/templateData/componentData[@id='team" + i + "rider1name']/data/@value",
        xlmDocument,
        null,
        XPathResult.STRING_TYPE,
        null
      ).stringValue;

      var rider2Name = xlmDocument.evaluate(
        "/templateData/componentData[@id='team" + i + "rider2name']/data/@value",
        xlmDocument,
        null,
        XPathResult.STRING_TYPE,
        null
      ).stringValue;

      var teamTime = xlmDocument.evaluate(
        "/templateData/componentData[@id='team" + i + "time']/data/@value",
        xlmDocument,
        null,
        XPathResult.STRING_TYPE,
        null
      ).stringValue;

      animation.renderer.elements[element0Number].elements[3].canResizeFont(true);
      animation.renderer.elements[element0Number].elements[3].updateDocumentData({
          t: teamPosition
        },
        0
      );

      animation.renderer.elements[element0Number].elements[4].canResizeFont(true);
      animation.renderer.elements[element0Number].elements[4].updateDocumentData({
          t: rider1Name
        },
        0
      );

      animation.renderer.elements[element0Number].elements[2].canResizeFont(true);
      animation.renderer.elements[element0Number].elements[2].updateDocumentData({
          t: rider2Name
        },
        0
      );

      animation.renderer.elements[element0Number].elements[0].canResizeFont(true);
      animation.renderer.elements[element0Number].elements[0].updateDocumentData({
          t: teamName
        },
        0
      );

      animation.renderer.elements[element0Number].elements[1].canResizeFont(true);
      animation.renderer.elements[element0Number].elements[1].updateDocumentData({
          t: teamTime
        },
        0
      );

    }

    for (i = 1; i < 4; i++) {
      if (i == 1) {
        element0Number = 17;
      }
      if (i == 2) {
        element0Number = 15;
      }
      if (i == 3) {
        element0Number = 13;
      }
      var teamPosition = xlmDocument.evaluate("/templateData/componentData[@id='master_team" + i +
        "position']/data/@value",
        xlmDocument, null, XPathResult.STRING_TYPE, null).stringValue;
      var teamName = xlmDocument.evaluate(
        "/templateData/componentData[@id='master_team" + i + "name']/data/@value", xlmDocument, null, XPathResult.STRING_TYPE,
        null
      ).stringValue;
      var rider1Name = xlmDocument.evaluate("/templateData/componentData[@id='master_team" + i +
        "rider1name']/data/@value", xlmDocument, null, XPathResult.STRING_TYPE, null).stringValue;
      var rider2Name = xlmDocument.evaluate(
        "/templateData/componentData[@id='master_team" + i + "rider2name']/data/@value", xlmDocument, null,
        XPathResult.STRING_TYPE, null).stringValue;
      var teamTime = xlmDocument.evaluate(
        "/templateData/componentData[@id='master_team" + i + "time']/data/@value", xlmDocument, null, XPathResult.STRING_TYPE,
        null
      ).stringValue;
      animation.renderer.elements[element0Number].elements[3].canResizeFont(true);
      animation.renderer.elements[element0Number].elements[3].updateDocumentData({
        t: teamPosition
      }, 0);
      animation.renderer.elements[element0Number].elements[4].canResizeFont(true);
      animation.renderer.elements[element0Number].elements[4].updateDocumentData({
        t: rider1Name
      }, 0);
      animation.renderer.elements[element0Number].elements[2].canResizeFont(true);
      animation.renderer.elements[element0Number].elements[2].updateDocumentData({
        t: rider2Name
      }, 0);
      animation.renderer.elements[element0Number].elements[0].canResizeFont(true);
      animation.renderer.elements[element0Number].elements[0].updateDocumentData({
        t: teamName
      }, 0);
      animation.renderer.elements[element0Number].elements[1].canResizeFont(true);
      animation.renderer.elements[element0Number].elements[1].updateDocumentData({
        t: teamTime
      }, 0);
    }

    for (i = 1; i < 4; i++) {
      if (i == 1) {
        element0Number = 9;
      }
      if (i == 2) {
        element0Number = 7;
      }
      if (i == 3) {
        element0Number = 5;
      }
      var teamPosition = xlmDocument.evaluate("/templateData/componentData[@id='g_team" + i + "position']/data/@value",
        xlmDocument, null, XPathResult.STRING_TYPE, null).stringValue;
      var teamName = xlmDocument.evaluate(
        "/templateData/componentData[@id='g_team" + i + "name']/data/@value", xlmDocument, null, XPathResult.STRING_TYPE,
        null).stringValue;
      var rider1Name = xlmDocument.evaluate("/templateData/componentData[@id='g_team" + i +
        "rider1name']/data/@value", xlmDocument, null, XPathResult.STRING_TYPE, null).stringValue;
      var rider2Name = xlmDocument.evaluate(
        "/templateData/componentData[@id='g_team" + i + "rider2name']/data/@value", xlmDocument, null,
        XPathResult.STRING_TYPE, null).stringValue;
      var teamTime = xlmDocument.evaluate(
        "/templateData/componentData[@id='g_team" + i + "time']/data/@value", xlmDocument, null, XPathResult.STRING_TYPE,
        null).stringValue;
      animation.renderer.elements[element0Number].elements[3].canResizeFont(true);
      animation.renderer.elements[element0Number].elements[3].updateDocumentData({
        t: teamPosition
      }, 0);
      animation.renderer.elements[element0Number].elements[4].canResizeFont(true);
      animation.renderer.elements[element0Number].elements[4].updateDocumentData({
        t: rider1Name
      }, 0);
      animation.renderer.elements[element0Number].elements[2].canResizeFont(true);
      animation.renderer.elements[element0Number].elements[2].updateDocumentData({
        t: rider2Name
      }, 0);
      animation.renderer.elements[element0Number].elements[0].canResizeFont(true);
      animation.renderer.elements[element0Number].elements[0].updateDocumentData({
        t: teamName
      }, 0);
      animation.renderer.elements[element0Number].elements[1].canResizeFont(true);
      animation.renderer.elements[element0Number].elements[1].updateDocumentData({
        t: teamTime
      }, 0);
    }

    var team1rider1Country = xlmDocument.evaluate("/templateData/componentData[@id='team1rider1Country']/data/@value",
      xlmDocument, null, XPathResult.STRING_TYPE, null).stringValue;

    var team1rider2Country = xlmDocument.evaluate("/templateData/componentData[@id='team1rider2Country']/data/@value",
      xlmDocument, null, XPathResult.STRING_TYPE, null).stringValue;

    var team2rider1Country = xlmDocument.evaluate("/templateData/componentData[@id='team2rider1Country']/data/@value",
      xlmDocument, null, XPathResult.STRING_TYPE, null).stringValue;

    var team2rider2Country = xlmDocument.evaluate("/templateData/componentData[@id='team2rider2Country']/data/@value",
      xlmDocument, null, XPathResult.STRING_TYPE, null).stringValue;

    var team3rider1Country = xlmDocument.evaluate("/templateData/componentData[@id='team3rider1Country']/data/@value",
      xlmDocument, null, XPathResult.STRING_TYPE, null).stringValue;

    var team3rider2Country = xlmDocument.evaluate("/templateData/componentData[@id='team3rider2Country']/data/@value",
      xlmDocument, null, XPathResult.STRING_TYPE, null).stringValue;

    var master_team1rider1Country =
      xlmDocument.evaluate("/templateData/componentData[@id='master_team1rider1Country']/data/@value",
        xlmDocument, null, XPathResult.STRING_TYPE, null).stringValue;

    var master_team1rider2Country =
      xlmDocument.evaluate("/templateData/componentData[@id='master_team1rider2Country']/data/@value",
        xlmDocument, null, XPathResult.STRING_TYPE, null).stringValue;

    var master_team2rider1Country =
      xlmDocument.evaluate("/templateData/componentData[@id='master_team2rider1Country']/data/@value",
        xlmDocument, null, XPathResult.STRING_TYPE, null).stringValue;

    var master_team2rider2Country =
      xlmDocument.evaluate("/templateData/componentData[@id='master_team2rider2Country']/data/@value",
        xlmDocument, null, XPathResult.STRING_TYPE, null).stringValue;

    var master_team3rider1Country =
      xlmDocument.evaluate("/templateData/componentData[@id='master_team3rider1Country']/data/@value",
        xlmDocument, null, XPathResult.STRING_TYPE, null).stringValue;

    var master_team3rider2Country =
      xlmDocument.evaluate("/templateData/componentData[@id='master_team3rider2Country']/data/@value",
        xlmDocument, null, XPathResult.STRING_TYPE, null).stringValue;


    var g_team1rider1Country =
      xlmDocument.evaluate("/templateData/componentData[@id='g_team1rider1Country']/data/@value",
        xlmDocument, null, XPathResult.STRING_TYPE, null).stringValue;


    var g_team1rider2Country =
      xlmDocument.evaluate("/templateData/componentData[@id='g_team1rider2Country']/data/@value",
        xlmDocument, null, XPathResult.STRING_TYPE, null).stringValue;

    var g_team2rider1Country =
      xlmDocument.evaluate("/templateData/componentData[@id='g_team2rider2Country']/data/@value",
        xlmDocument, null, XPathResult.STRING_TYPE, null).stringValue;

    var g_team2rider2Country =
      xlmDocument.evaluate("/templateData/componentData[@id='g_team2rider2Country']/data/@value",
        xlmDocument, null, XPathResult.STRING_TYPE, null).stringValue;

    var g_team3rider1Country =
      xlmDocument.evaluate("/templateData/componentData[@id='g_team3rider1Country']/data/@value",
        xlmDocument, null, XPathResult.STRING_TYPE, null).stringValue;

    var g_team3rider2Country =
      xlmDocument.evaluate("/templateData/componentData[@id='g_team3rider2Country']/data/@value",
        xlmDocument, null, XPathResult.STRING_TYPE, null).stringValue;

    console.log(team1rider2Country);

    const imageElements = container.getElementsByTagName("image");
    for (let j = 0; j < imageElements.length; j++) {
      const element = imageElements[j];
      updateFlag(element, "img_19.png", team1rider1Country);
      updateFlag(element, "img_20.png", team1rider2Country);
      updateFlag(element, "img_17.png", team2rider1Country);
      updateFlag(element, "img_18.png", team2rider2Country);
      updateFlag(element, "img_15.png", team3rider1Country);
      updateFlag(element, "img_16.png", team3rider2Country);

      updateFlag(element, "img_13.png", master_team1rider1Country);
      updateFlag(element, "img_14.png", master_team1rider2Country);
      updateFlag(element, "img_11.png", master_team2rider1Country);
      updateFlag(element, "img_12.png", master_team2rider2Country);
      updateFlag(element, "img_9.png", master_team3rider1Country);
      updateFlag(element, "img_10.png", master_team3rider2Country);

      updateFlag(element, "img_7.png", g_team1rider1Country);
      updateFlag(element, "img_8.png", g_team1rider2Country);
      updateFlag(element, "img_5.png", g_team2rider1Country);
      updateFlag(element, "img_6.png", g_team2rider2Country);
      updateFlag(element, "img_3.png", g_team3rider1Country);
      updateFlag(element, "img_4.png", g_team3rider2Country);
    }
  }

  function updateFlag(element, currentFlag, newFlag) {
    if (~element.getAttribute("href").search("images/" + currentFlag)) {

      var flag = "../../flags/" + newFlag + ".png"
      element.setAttribute("href", flag);
    }
  }
</script>