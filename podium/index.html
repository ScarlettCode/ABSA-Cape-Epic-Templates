<style>
  html,
  body {
    width: 1920px;
    height: 1080px;
    margin: 0;
    padding: 0;
  }
</style>

<body>

  <div>
    <div id="bm"></div>
  </div>

</body>

<script src="../scripts/lottie.min.js" type="text/javascript"></script>
<script src="../scripts/utils.js" type="text/javascript"></script>
<script src="../scripts/webfontloader.js" type="text/javascript"></script>
<script src="../scripts/moment.min.js" type="text/javascript"></script>
<script src="../scripts/countdown.min.js" type="text/javascript"></script>

<script src="data.js" type="text/javascript"></script>

<script>
  WebFont.load({
    custom: {
      urls: ["../fonts/stylesheet.css"]
    }
  });
</script>

<script type="text/javascript">
  container = document.getElementById("bm");

  var animation = bodymovin.loadAnimation({
    container: container,
    renderer: "svg",
    loop: false,
    autoplay: false,
    animationData: test,
    font: "",
    rendererSettings: {}
  });

  if (debug) {
    findElementLocations(animation);
    animation.play();
  }

  function play() {
    animation.stop();
    animation.play();
  }

  function stop() {
    animation.stop();
    animation.play();
  }

  function update(xml) {


    var parser = new DOMParser();
    var xmlDocument = parser.parseFromString(xml, "text/xml");

    var title = xmlDocument.evaluate(
      "/templateData/componentData[@id='title']/data/@value",
      xmlDocument,
      null,
      XPathResult.STRING_TYPE,
      null
    ).stringValue;

    var category = xmlDocument.evaluate(
      "/templateData/componentData[@id='category']/data/@value",
      xmlDocument,
      null,
      XPathResult.STRING_TYPE,
      null
    ).stringValue;

    var team1position = xmlDocument.evaluate(
      "/templateData/componentData[@id='team1position']/data/@value",
      xmlDocument,
      null,
      XPathResult.STRING_TYPE,
      null
    ).stringValue;

    var team1name = xmlDocument.evaluate(
      "/templateData/componentData[@id='team1name']/data/@value",
      xmlDocument,
      null,
      XPathResult.STRING_TYPE,
      null
    ).stringValue;

    var team1rider1country = xmlDocument.evaluate(
      "/templateData/componentData[@id='team1rider1country']/data/@value",
      xmlDocument,
      null,
      XPathResult.STRING_TYPE,
      null
    ).stringValue;

    var team1rider2country = xmlDocument.evaluate(
      "/templateData/componentData[@id='team1rider2country']/data/@value",
      xmlDocument,
      null,
      XPathResult.STRING_TYPE,
      null
    ).stringValue;

    var team1rider1name = xmlDocument.evaluate(
      "/templateData/componentData[@id='team1rider1name']/data/@value",
      xmlDocument,
      null,
      XPathResult.STRING_TYPE,
      null
    ).stringValue;

    var team1rider2name = xmlDocument.evaluate(
      "/templateData/componentData[@id='team1rider2name']/data/@value",
      xmlDocument,
      null,
      XPathResult.STRING_TYPE,
      null
    ).stringValue;


    var team2position = xmlDocument.evaluate(
      "/templateData/componentData[@id='team2position']/data/@value",
      xmlDocument,
      null,
      XPathResult.STRING_TYPE,
      null
    ).stringValue;

    var team2name = xmlDocument.evaluate(
      "/templateData/componentData[@id='team2name']/data/@value",
      xmlDocument,
      null,
      XPathResult.STRING_TYPE,
      null
    ).stringValue;

    var team2rider1country = xmlDocument.evaluate(
      "/templateData/componentData[@id='team2rider1country']/data/@value",
      xmlDocument,
      null,
      XPathResult.STRING_TYPE,
      null
    ).stringValue;

    var team2rider2country = xmlDocument.evaluate(
      "/templateData/componentData[@id='team2rider2country']/data/@value",
      xmlDocument,
      null,
      XPathResult.STRING_TYPE,
      null
    ).stringValue;

    var team2rider1name = xmlDocument.evaluate(
      "/templateData/componentData[@id='team2rider1name']/data/@value",
      xmlDocument,
      null,
      XPathResult.STRING_TYPE,
      null
    ).stringValue;

    var team2rider2name = xmlDocument.evaluate(
      "/templateData/componentData[@id='team2rider2name']/data/@value",
      xmlDocument,
      null,
      XPathResult.STRING_TYPE,
      null
    ).stringValue;

    var team3position = xmlDocument.evaluate(
      "/templateData/componentData[@id='team3position']/data/@value",
      xmlDocument,
      null,
      XPathResult.STRING_TYPE,
      null
    ).stringValue;

    var team3name = xmlDocument.evaluate(
      "/templateData/componentData[@id='team3name']/data/@value",
      xmlDocument,
      null,
      XPathResult.STRING_TYPE,
      null
    ).stringValue;

    var team3rider1country = xmlDocument.evaluate(
      "/templateData/componentData[@id='team3rider1country']/data/@value",
      xmlDocument,
      null,
      XPathResult.STRING_TYPE,
      null
    ).stringValue;

    var team3rider2country = xmlDocument.evaluate(
      "/templateData/componentData[@id='team3rider2country']/data/@value",
      xmlDocument,
      null,
      XPathResult.STRING_TYPE,
      null
    ).stringValue;

    var team3rider1name = xmlDocument.evaluate(
      "/templateData/componentData[@id='team3rider1name']/data/@value",
      xmlDocument,
      null,
      XPathResult.STRING_TYPE,
      null
    ).stringValue;

    var team3rider2name = xmlDocument.evaluate(
      "/templateData/componentData[@id='team3rider2name']/data/@value",
      xmlDocument,
      null,
      XPathResult.STRING_TYPE,
      null
    ).stringValue;

    animation.renderer.elements[1].elements[1].elements[0].canResizeFont(true);
    animation.renderer.elements[1].elements[1].elements[0].updateDocumentData({
        t: title
      },
      0
    );

    animation.renderer.elements[1].elements[2].elements[0].canResizeFont(true);
    animation.renderer.elements[1].elements[2].elements[0].updateDocumentData({
        t: category
      },
      0
    );

    updateSVG(0, 1, 2, team1position);
    updateSVG(0, 1, 3, team1rider1name);
    updateSVG(0, 1, 1, team1rider2name);
    updateSVG(0, 1, 0, team1name);

    updateSVG(1, 1, 2, team2position);
    updateSVG(1, 1, 3, team2rider1name);
    updateSVG(1, 1, 1, team2rider2name);
    updateSVG(1, 1, 0, team2name);

    updateSVG(2, 1, 4, team3position);
    updateSVG(2, 1, 5, team3rider1name);
    updateSVG(2, 1, 3, team3rider2name);
    updateSVG(2, 1, 2, team3name);

    console.log(team3rider1country);

    const imageElements = container.getElementsByTagName("image");
    for (let i = 0; i < imageElements.length; i++) {
      const element = imageElements[i];

      updateFlag(element, "img_2.png", team1rider1country);
      updateFlag(element, "img_3.png", team1rider2country);

      updateFlag(element, "img_5.png", team2rider1country);
      updateFlag(element, "img_4.png", team2rider2country);

      updateFlag(element, "img_7.png", team3rider1country);
      updateFlag(element, "img_6.png", team3rider2country);
    }

    const catName = document.getElementById("CatName");
    var colour = convertCategoryToColour(category)
    catName.childNodes[0].childNodes[0].style.fill = colour;
  }

  function updateFlag(element, currentFlag, newFlag) {
    if (~element.getAttribute("href").search("images/" + currentFlag)) {
      element.setAttribute("href", "../flags/" +
        newFlag + ".png");
    }
  }

  function updateSVG(element3, element4, element5, text) {
    animation.renderer.elements[1].elements[3].elements[element3].elements[element4].elements[element5].canResizeFont(
      true
    );
    animation.renderer.elements[1].elements[3].elements[element3].elements[element4].elements[element5].updateDocumentData({
        t: text
      },
      0
    );
  }
</script>